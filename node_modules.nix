{
  pkgs ? import <nixpkgs> { },
  ...
}:
let
  lib = pkgs.lib;
  extractTarball =
    src:
    pkgs.runCommand "extracted-${src.name}" { } ''
      mkdir "$out"
      ${pkgs.libarchive}/bin/bsdtar -xf ${src} --strip-components 1 -C "$out"
    '';
  packages = {
    "@types/bun" = extractTarball (
      pkgs.fetchurl {
        url = "https://registry.npmjs.org/@types/bun/-/bun-1.2.11.tgz";
        hash = "sha512-ZLbbI91EmmGwlWTRWuV6J19IUiUC5YQ3TCEuSHI3usIP75kuoA8/0PVF+LTrbEnVc8JIhpElWOxv1ocI1fJBbw==";
      }
    );
    "@types/node" = extractTarball (
      pkgs.fetchurl {
        url = "https://registry.npmjs.org/@types/node/-/node-22.15.3.tgz";
        hash = "sha512-lX7HFZeHf4QG/J7tBZqrCAXwz9J5RD56Y6MpP0eJkka8p+K0RY/yBTW7CYFJ4VGCclxqOLKmiGP5juQc6MKgcw==";
      }
    );
    "bun-types" = extractTarball (
      pkgs.fetchurl {
        url = "https://registry.npmjs.org/bun-types/-/bun-types-1.2.11.tgz";
        hash = "sha512-dbkp5Lo8HDrXkLrONm6bk+yiiYQSntvFUzQp0v3pzTAsXk6FtgVMjdQ+lzFNVAmQFUkPQZ3WMZqH5tTo+Dp/IA==";
      }
    );
    "fsevents" = extractTarball (
      pkgs.fetchurl {
        url = "https://registry.npmjs.org/fsevents/-/fsevents-2.3.2.tgz";
        hash = "sha512-xiqMQR4xAeHTuB9uWm+fFRcIOgKBMiOBP+eXiyT7jsgVCq1bkVygt00oASowB7EdtpOHaaPgKt812P9ab+DDKA==";
      }
    );
    "playwright" = extractTarball (
      pkgs.fetchurl {
        url = "https://registry.npmjs.org/playwright/-/playwright-1.54.1.tgz";
        hash = "sha512-peWpSwIBmSLi6aW2auvrUtf2DqY16YYcCMO8rTVx486jKmDTJg7UAhyrraP98GB8BoPURZP8+nxO7TSd4cPr5g==";
      }
    );
    "playwright-core" = extractTarball (
      pkgs.fetchurl {
        url = "https://registry.npmjs.org/playwright-core/-/playwright-core-1.54.1.tgz";
        hash = "sha512-Nbjs2zjj0htNhzgiy5wu+3w09YetDx5pkrpI/kZotDlDUaYk0HVA5xrBVPdow4SAUIlhgKcJeJg4GRKW6xHusA==";
      }
    );
    "undici-types" = extractTarball (
      pkgs.fetchurl {
        url = "https://registry.npmjs.org/undici-types/-/undici-types-6.21.0.tgz";
        hash = "sha512-iwDZqg0QAGrg9Rav5H4n0M64c3mkR59cJ6wQp+7C4nI0gsmExaedaYLNO44eT4AtBBwjbTiGPMlt2Md0T9H9JQ==";
      }
    );
  };
in
lib.pipe packages [
  (lib.mapAttrsToList (
    name: package: ''
      mkdir -p "$out/${name}"
      cp -Lr ${package}/* "$out/${name}"
    ''
  ))
  (lib.concatStringsSep "\n")
  (pkgs.runCommand "node_modules" { })
]
